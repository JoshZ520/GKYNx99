<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.io Test - Table Talk</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px dotted #ccc;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîå Socket.io Connection Test</h1>
        <p>This page tests the basic connection between your browser and the server.</p>
        
        <div id="status" class="status disconnected">
            ‚ùå Not connected to server
        </div>
        
        <div>
            <h3>What to watch for:</h3>
            <ul>
                <li><strong>Browser Console:</strong> Open DevTools (F12) ‚Üí Console tab</li>
                <li><strong>Server Terminal:</strong> Watch the server.js console</li>
                <li><strong>Status above:</strong> Should turn green when connected</li>
            </ul>
        </div>
        
        <h3>Connection Log:</h3>
        <div id="log" class="log">
            <div class="log-entry">‚è≥ Waiting for connection...</div>
        </div>
        
        <div>
            <button onclick="testConnection()">Send Test Message</button>
            <button onclick="sendCustomMessage()">Send Custom Message</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <div style="margin: 10px 0;">
            <input type="text" id="customMessage" placeholder="Type a message to send to server..." style="width: 300px; padding: 8px;">
            <button onclick="sendCustomMessage()">Send</button>
        </div>
        
        <div>
            <h3>Next Steps:</h3>
            <ol>
                <li>Start the server: <code>cd server && npm install && npm start</code></li>
                <li>Open multiple browser tabs to see multiple connections</li>
                <li>Watch both browser console and server terminal</li>
                <li>Look for socket IDs and connection messages</li>
            </ol>
        </div>
    </div>

    <!-- Socket.io Client Library -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        // This will hold our socket connection
        let socket = null;
        
        // Get DOM elements
        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('log');
        
        // Function to add log entries
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // Also log to console for debugging
            console.log(`[Socket.io] ${message}`);
        }
        
        // Function to update connection status
        function updateStatus(connected, socketId = null) {
            if (connected) {
                statusDiv.className = 'status connected';
                statusDiv.innerHTML = `‚úÖ Connected to server (ID: ${socketId})`;
            } else {
                statusDiv.className = 'status disconnected';
                statusDiv.innerHTML = '‚ùå Not connected to server';
            }
        }
        
        // Initialize Socket.io connection
        function initializeSocket() {
            addLog('üîÑ Attempting to connect to server...');
            
            // Create socket connection
            socket = io();
            
            // When we successfully connect
            socket.on('connect', () => {
                addLog(`üîå Connected! Socket ID: ${socket.id}`);
                updateStatus(true, socket.id);
            });
            
            // When we receive the welcome message from server
            socket.on('welcome', (data) => {
                addLog(`üì® Welcome message received: "${data.message}" at ${data.timestamp}`);
            });
            
            // STEP 2: Handle test responses from server
            socket.on('test-response', (data) => {
                addLog(`üîÑ Server responded: "${data.message}" at ${data.serverTime}`);
            });
            
            // STEP 2: Handle messages from other clients
            socket.on('someone-sent-message', (data) => {
                addLog(`üë• Someone else (${data.from}) sent: "${data.message}" at ${data.timestamp}`);
            });
            
            // When connection is lost
            socket.on('disconnect', (reason) => {
                addLog(`‚ùå Disconnected. Reason: ${reason}`);
                updateStatus(false);
            });
            
            // When trying to reconnect
            socket.on('reconnect_attempt', (attempt) => {
                addLog(`üîÑ Reconnection attempt #${attempt}`);
            });
            
            // When reconnected
            socket.on('reconnect', (attempt) => {
                addLog(`‚úÖ Reconnected after ${attempt} attempts`);
                updateStatus(true, socket.id);
            });
            
            // Connection error
            socket.on('connect_error', (error) => {
                addLog(`üö´ Connection error: ${error.message}`);
            });
        }
        
        // Test connection function
        function testConnection() {
            if (socket && socket.connected) {
                const testMessages = [
                    'Hello from browser!',
                    'Testing Socket.io messaging',
                    'Real-time communication works!',
                    'This is awesome! üöÄ',
                    'Ready for multiplayer gaming!'
                ];
                
                const randomMessage = testMessages[Math.floor(Math.random() * testMessages.length)];
                
                addLog(`üì§ Sending test message: "${randomMessage}"`);
                socket.emit('test-message', { 
                    message: randomMessage, 
                    timestamp: Date.now() 
                });
            } else {
                addLog('‚ö†Ô∏è Not connected to server. Check if server is running.');
            }
        }
        
        // Send custom message function
        function sendCustomMessage() {
            const input = document.getElementById('customMessage');
            const message = input.value.trim();
            
            if (!message) {
                addLog('‚ö†Ô∏è Please type a message first');
                return;
            }
            
            if (socket && socket.connected) {
                addLog(`üì§ Sending custom message: "${message}"`);
                socket.emit('test-message', { 
                    message: message, 
                    timestamp: Date.now() 
                });
                input.value = ''; // Clear input
            } else {
                addLog('‚ö†Ô∏è Not connected to server');
            }
        }
        
        // Clear log function
        function clearLog() {
            logDiv.innerHTML = '<div class="log-entry">üìù Log cleared</div>';
        }
        
        // Start the connection when page loads
        document.addEventListener('DOMContentLoaded', () => {
            addLog('üöÄ Page loaded, initializing Socket.io...');
            initializeSocket();
            
            // Add Enter key support for custom message input
            document.getElementById('customMessage').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendCustomMessage();
                }
            });
        });
    </script>
</body>
</html>