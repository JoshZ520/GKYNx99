<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<title>Table Talk</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css">
<!-- Consolidated styles -->
<link rel="stylesheet" href="../assets/css/shared.css">
<link rel="stylesheet" href="../assets/css/shared/buttons.css">
<link rel="stylesheet" href="../assets/css/shared/forms.css">
<link rel="stylesheet" href="../assets/css/shared/animations.css">
<link rel="stylesheet" href="../assets/css/shared/responsive.css">
<link rel="stylesheet" href="../assets/css/game-ui.css">
<link rel="stylesheet" href="../assets/css/game-multiplayer.css">
<link rel="stylesheet" href="../assets/css/components.css">
<script src="../src/ui/theme-utilities.js" defer></script>
<!-- Core game modules -->
<script src="../src/config/game-config.js" type="module" defer></script>
<script src="../src/core/question-manager.js" type="module" defer></script>
<script src="../src/core/player-manager.js" type="module" defer></script>
<script src="../src/ui/ui-manager.js" type="module" defer></script>
<!-- Transport layer - interface loads first, then handlers register -->
<script src="../src/transport/transport-interface.js" type="module"></script>
<script type="module" src="../src/transport/offline-handler.js"></script>
<!-- Game loader conditionally loads socket.io and multiplayer-handler based on mode -->
<script src="../src/core/game-loader.js" type="module" defer></script>

</head>
<body class="game-page" id="root">
<script>
// Immediately hide/show elements based on game mode (before page renders)
(function() {
    const gameMode = sessionStorage.getItem('gameMode');
    const isOffline = gameMode === 'offline';
    
    if (isOffline) {
        // OFFLINE MODE: Hide multiplayer, show offline
        const style = document.createElement('style');
        style.textContent = `
            #multiplayerInfo,
            #createRoomSection,
            #waitingForPlayers,
            #answerProgressContainer {
                display: none !important;
            }
            #offlineSubmitContainer,
            #offlinePlayerIndicator,
            #offlineModeNotice {
                display: block !important;
            }
        `;
        document.head.appendChild(style);
        
        // Initialize player indicator when DOM is ready
        window.addEventListener('DOMContentLoaded', function() {
            const playerNames = JSON.parse(sessionStorage.getItem('playerNames') || '[]');
            const currentPlayerName = document.getElementById('currentPlayerName');
            if (currentPlayerName && playerNames.length > 0) {
                currentPlayerName.textContent = playerNames[0];
            }
        });
    } else {
        // ONLINE/MULTIPLAYER MODE (default): Show multiplayer, hide offline
        const style = document.createElement('style');
        style.textContent = `
            /* Hide offline-only elements */
            #offlineSubmitContainer,
            #offlinePlayerIndicator,
            #offlineModeNotice {
                display: none !important;
            }
            /* Override .hidden class for multiplayer elements */
            #createRoomSection.hidden,
            #multiplayerInfo.hidden,
            #answerProgressContainer.hidden {
                display: block !important;
            }
        `;
        document.head.appendChild(style);
    }
})();
</script>
<header id="header">

<!-- Offline Mode Notice -->
<div id="offlineModeNotice" class="offline-notice hidden">
<p><strong>Offline Mode:</strong> Pass this device between players for their turns. Everyone takes turns on the same screen.</p>
</div>
</div>

<!-- Create Room Button (shown before room is created) -->
<div id="createRoomSection" class="create-room-section hidden">
<p>Ready to start your multiplayer game?</p>
<button id="createRoomBtn" class="start-btn">Create Room</button>
</div>

<!-- Multiplayer Room Info (hidden until room is created) -->
<div id="multiplayerInfo" class="multiplayer-info hidden">
<div class="room-display">
<!-- QR Code Section -->
<div class="qr-code-section">
<p>Scan to join on your phone:</p>
<img src="/assets/images/table-talk-qr.png" alt="QR Code for Player Page">
</div>
<div class="room-code-section">
<span class="room-label">Room Code:</span>
<span class="room-code" id="roomCodeDisplay">----</span>
<button class="copy-code-btn" id="copyCodeBtn" title="Copy room code">Copy</button>
</div>
<div class="players-section">
<span class="players-label">Connected Players (<span id="playerCount">0</span>):</span>
<div class="players-list" id="connectedPlayersList"></div>
</div>
</div>
</div>
</header>
<main>
    <div class="popup" id="popup">
        <div class="direction">
            <button id="close"><svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z"
    fill="currentColor"
  />
</svg></button>
            <h1>Directions: </h1>
            <ol>
                <li>Choose a topic to start.</li>
                <li>Answer to the question you choose.</li>
                <li>You can finish the game by pressing "All Answers Finished", but you can still continue it by changing a question.</li>
                <li>Discuss the result you get!</li>
            </ol>
            <div class="game-navigation">
                <button class="back-to-mode-btn smooth-transition" id="backToModeBtn" type="button" onclick="window.location.href='index.html'">
                <img src="../assets/images/icons/previous.svg" alt="Back" width="16" height="16">
                Back to Game Mode
                </button>
                <p class="setup-link"><strong>Need to change players?</strong> <a href="index.html">‚Üê Back to Setup</a></p>
            </div>
        </div>
    </div>
    <div id="gameContainer">
    <!-- Current Player Indicator (Offline Mode Only) -->
    <div id="offlinePlayerIndicator" class="player-indicator">
        <span>Current Player: <strong id="currentPlayerName">Player</strong></span>
    </div>

    <!-- Waiting for Players (Multiplayer Mode Only) -->
    <div id="waitingForPlayers" class="waiting-message hidden">
        <h3>‚è≥ Waiting for Players...</h3>
        <p>Need at least 2 players to start the game.</p>
        <p>Share the room code with your friends!</p>
    </div>

<!-- Random Topic Button - Centered -->
<div class="random-topic-container">
    <button class="remote-btn smooth-transition" id="randomTopicBtn" type="button" title="Random Topic">
        <img src="../assets/images/icons/random-dice.svg" alt="Random Topic" width="20" height="20">
        <span class="remote-label">Random Topic</span>
    </button>
</div>
<h1 class="question" id="question">Please select a topic to begin</h1>
<div class="topic-selection">
<button class="smooth-transition" id="topicsToggle">Topics ‚ñº</button>
<!-- Collapsible topic grid with pagination -->
<div class="topics-panel hidden" id="topicsPanel">
<div class="topics-pagination-header">
<span class="page-info" id="pageInfo">Page 1 of 2</span>
<div class="pagination-controls">
<button class="page-btn smooth-transition" id="prevPageBtn" disabled>‚Äπ Previous</button>
<button class="page-btn smooth-transition" id="nextPageBtn">Next ‚Ä∫</button>
</div>
</div>
<div class="topics-grid" id="topicsGrid">
<!-- Populated by JavaScript -->
</div>
</div>
</div>
<!-- Topic display -->
<div id="currentTopicDisplay" class="current-topic-display">
<span class="topic-name" id="currentTopicName">No topic selected</span>
</div>
<!-- Remote Control Layout -->
<div class="remote-control">
<div class="remote-row">
<!-- Previous Question Button -->
<div class="remote-button-container">
<button class="remote-btn smooth-transition" id="prevQuestionBtn" type="button" title="Previous Question">
<img src="../assets/images/icons/previous.svg" alt="Previous" width="20" height="20">
</button>
<span class="remote-label">Previous</span>
</div>
<!-- Random Question Button (Center) -->
<div class="remote-button-container center">
<button class="switch_button smooth-transition flex-center" id="switchQuestion" type="button" title="Random Question in Current Topic">
<img id="changeQ" src="../assets/images/icons/refresh.svg" alt="Switch Question" width="24" height="24">
</button>
<span class="remote-label">Random Question</span>
</div>
<!-- Next Question Button -->
<div class="remote-button-container">
<button class="remote-btn smooth-transition" id="nextQuestionBtn" type="button" title="Next Question">
<img src="../assets/images/icons/next.svg" alt="Next" width="20" height="20">
</button>
<span class="remote-label">Next</span>
</div>
</div>
</div>
<!-- Image-based preference selection -->
<div class="preference-container" id="preferenceContainer" class="hidden">
    <div class="preference-options" id="optionsContainer">
        <!-- Options will be rendered by JS -->
    </div>
</div>
<!-- Hidden field to store the selected preference (offline logic will ignore this) -->
<input type="hidden" id="selectedPreference" value="">

<!-- Answer Progress Display for Multiplayer -->
<div id="answerProgressContainer" class="answer-progress-container hidden">
    <p id="answerProgress">0/0 players answered</p>
    <button class="fin" id="revealAnswersBtn" type="button">Reveal All Answers</button>
</div>

<!-- Submit Answer Button (Offline Mode Only) -->
<div class="buttons" id="offlineSubmitContainer">
    <button class="submit" id="submitButton" type="button">Submit Answer</button>
    <button class="fin" id="final_submit" type="button">Show Results</button>
</div>

<!-- Question Results Bar (Multiplayer - shows after revealing answers) -->
<div id="questionResultsBar" class="question-results-bar">
    <h4>üìä Results:</h4>
    <div id="resultsBarContent"></div>
</div>

<!-- Host controls -->
<div class="buttons">
<button class="fin" id="end_game_btn" type="button">End Game & Show All Results</button>
</div>

<!-- All Results Display (shows all questions at end of game) -->
<div id="allResultsDisplay" class="all-results-display hidden">
    <div class="results-overlay-bg"></div>
    <div class="results-modal">
        <h2>Game Results</h2>
        <div class="results-navigation">
            <button id="prevResultBtn" class="nav-btn">‚Üê Previous</button>
            <span id="resultCounter">Question 1 of X</span>
            <button id="nextResultBtn" class="nav-btn">Next ‚Üí</button>
        </div>
        <div id="allResultsContent"></div>
        <button id="closeResultsBtn" class="close-results-btn">Close Results</button>
    </div>
</div>
</div><!-- End gameContainer -->

<!-- Results Section (hidden during gameplay) -->
<section id="gameResults" class="game-results hidden">
    <div class="results-container">
        <header class="results-header">
            <h2>üéâ Game Complete!</h2>
            <p class="results-subtitle">Here's a summary of your Table Talk session</p>
        </header>
        
        <div class="results-content">
            <div class="game-stats">
                <div class="stat-item">
                    <span class="stat-label">Questions Answered:</span>
                    <span class="stat-value" id="totalQuestions">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Players:</span>
                    <span class="stat-value" id="totalPlayers">0</span>
                </div>
            </div>
            
            <div class="questions-summary">
                <h3>Questions & Answers</h3>
                <div id="questionsList" class="questions-list">
                    <!-- Questions and answers will be populated here -->
                </div>
            </div>
        </div>
        
        <div class="results-actions">
            <button class="start-btn" id="continueGameBtn" type="button">Continue Playing</button>
            <button class="secondary-btn" id="playAgainBtn" type="button">Play Again</button>
            <button class="secondary-btn" id="backToMenuBtn" type="button">Back to Menu</button>
        </div>
    </div>
</section>
</main>



<footer>
<h2>About: </h2>
<p>The purpose of this game is to get to know people.</p>
<p>Ask Away</p>
</footer>

<!-- Conditionally load multiplayer scripts -->

</body>
</html>