<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<title>Table Talk</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css">
<!-- Consolidated styles -->
<link rel="stylesheet" href="../assets/css/shared.css">
<link rel="stylesheet" href="../assets/css/shared/buttons.css">
<link rel="stylesheet" href="../assets/css/shared/forms.css">
<link rel="stylesheet" href="../assets/css/shared/animations.css">
<link rel="stylesheet" href="../assets/css/shared/responsive.css">
<link rel="stylesheet" href="../assets/css/game/game-layout.css">
<link rel="stylesheet" href="../assets/css/game/game-topics.css">
<link rel="stylesheet" href="../assets/css/game/game-settings.css">
<link rel="stylesheet" href="../assets/css/game/game-results.css">
<link rel="stylesheet" href="../assets/css/game-ui.css">
<link rel="stylesheet" href="../assets/css/game-multiplayer.css">
<link rel="stylesheet" href="../dev-tools/dev-tools.css">
<link rel="stylesheet" href="../assets/css/components.css">
<script src="../src/ui/settings-builder.js"></script>
<script src="../src/ui/theme-utilities.js" defer></script>
<!-- Core game modules -->
<script src="../src/core/game-config.js" type="module" defer></script>
<script src="../src/core/question-manager.js" type="module" defer></script>
<script src="../src/core/player-manager.js" type="module" defer></script>
<script src="../src/ui/ui-manager.js" type="module" defer></script>
<!-- Transport layer - interface loads first, then handlers register -->
<script src="../src/multiplayer/transport-interface.js" type="module"></script>
<!-- Multiplayer scripts - always loaded -->
<script src="/socket.io/socket.io.js"></script>
<script src="../src/multiplayer/handler.js" type="module"></script>

</head>
<body class="game-page" id="root">
<header id="header">

<!-- Create Room Button (shown before room is created) -->
<div id="createRoomSection" class="create-room-section hidden">
<p>Ready to start your multiplayer game?</p>
<button id="createRoomBtn" class="start-btn">Create Room</button>
</div>

<!-- Dev Tools (only visible in dev environment) -->
<div id="devTools" class="dev-tools hidden">
<p>Dev Mode</p>
<a href="/pages/player/index.html" target="_blank">Open Player Screen</a>
</div>

<!-- Multiplayer Room Info -->
<div id="multiplayerInfo" class="multiplayer-info">
    <div class="room-display">
    <!-- QR Code Section -->
        <div class="join">
            <div class="room-code-section">
                <span class="room-label">Room Code:</span>
                <span class="room-code" id="roomCodeDisplay">----</span>
            </div>
            <div class="qr-code-section">
                <p>Scan to join on your phone:</p>
                <img src="/assets/images/table-talk-qr.png" alt="QR Code for Player Page">
            </div>
        </div>
        <div class="settings-container">
            <h2 class="settings-title">Game Settings</h2>
            <div id="multiplayerSettingsContainer"></div>
        </div>

        <div class="players-section">
            <span class="players-label">Connected Players (<span id="playerCount">0</span>):</span>
            <div class="players-list" id="connectedPlayersList"></div>
        </div>
    </div>
</div>
</header>
<main>
    <div class="popup" id="popup">
        <div class="direction">
            <button id="close"><svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z"
    fill="currentColor"
  />
</svg></button>
            <h1>Directions: </h1>
            <ol>
                <li>Choose a topic to start.</li>
                <li>Answer to the question you choose.</li>
                <li>You can finish the game by pressing "All Answers Finished", but you can still continue it by changing a question.</li>
                <li>Discuss the result you get!</li>
            </ol>
            <div class="game-navigation">
                <button class="back-to-mode-btn smooth-transition" id="backToModeBtn" type="button" onclick="window.location.href='index.html'">
                <img src="../assets/images/icons/previous.svg" alt="Back" width="16" height="16">
                Back to Game Mode
                </button>
                <p class="setup-link"><strong>Need to change players?</strong> <a href="index.html">← Back to Setup</a></p>
            </div>
        </div>
    </div>
    <div class="popup hidden" id="askCon">
        <div class="number_reached">
            <h3>Question Limit Reached!</h3>
            <p>You've answered <strong id="questionsAnsweredCount">0</strong> questions.</p>
            <p>Would you like to continue playing?</p>
            <div class="add-questions-group">
                <label for="addQuestionsSelect">Add more questions:</label>
                <select id="addQuestionsSelect" class="setting-select">
                    <option value="3">3 Questions</option>
                    <option value="5" selected>5 Questions</option>
                    <option value="10">10 Questions</option>
                    <option value="20">20 Questions</option>
                    <option value="Infinity">Remove Limit</option>
                </select>
            </div>
            <div class="popup-actions">
                <button class="continue" id="continueGameBtn" type="button">Continue Playing</button>
                <button class="fin" id="endGameFromLimitBtn" type="button">End Game</button>
            </div>
        </div>
    </div>
    <div id="gameContainer">
    <!-- Waiting for Players (Multiplayer Mode Only) -->
    <div id="waitingForPlayers" class="waiting-message hidden">
        <h3> Waiting for Players...</h3>
        <p>Need at least 2 players to start the game.</p>
        <p>Share the room code with your friends!</p>
    </div>

<!-- Random Topic Button - Centered -->
    <button id="directionDisplay" class="direction-button" type="button"><svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M11 10.9794C11 10.4271 11.4477 9.97937 12 9.97937C12.5523 9.97937 13 10.4271 13 10.9794V16.9794C13 17.5317 12.5523 17.9794 12 17.9794C11.4477 17.9794 11 17.5317 11 16.9794V10.9794Z"
    fill="currentColor"
  />
  <path
    d="M12 6.05115C11.4477 6.05115 11 6.49886 11 7.05115C11 7.60343 11.4477 8.05115 12 8.05115C12.5523 8.05115 13 7.60343 13 7.05115C13 6.49886 12.5523 6.05115 12 6.05115Z"
    fill="currentColor"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12Z"
    fill="currentColor"
  />
</svg><p>Directions</p></button>

<div class="random-topic-container">
    <button class="remote-btn smooth-transition" id="randomTopicBtn" type="button" title="Random Topic" disabled>
        <img src="../assets/images/icons/random-dice.svg" alt="Random Topic" width="20" height="20">
        <span class="remote-label">Random Topic</span>
    </button>
</div>
<h1 class="question" id="question">Please select a topic to begin</h1>
<div class="topic-selection">
<button class="smooth-transition" id="topicsToggle" disabled>Topics ▼</button>
<!-- Collapsible topic grid with pagination -->
<div class="topics-panel hidden" id="topicsPanel">
<div class="topics-pagination-header">
<span class="page-info" id="pageInfo">Page 1 of 2</span>
<div class="pagination-controls">
<button class="page-btn smooth-transition" id="prevPageBtn" disabled>‹ Previous</button>
<button class="page-btn smooth-transition" id="nextPageBtn">Next ›</button>
</div>
</div>
<div class="topics-grid" id="topicsGrid">
<!-- Populated by JavaScript -->
</div>
</div>
</div>
<!-- Topic display -->
<div id="currentTopicDisplay" class="current-topic-display">
<span class="topic-name" id="currentTopicName">No topic selected</span>
</div>
<!-- Remote Control Layout -->
<div class="remote-control">
<div class="remote-row">
<!-- Previous Question Button -->
<div class="remote-button-container">
<button class="remote-btn smooth-transition" id="prevQuestionBtn" type="button" title="Previous Question">
<img src="../assets/images/icons/previous.svg" alt="Previous" width="20" height="20">
</button>
<span class="remote-label">Previous</span>
</div>
<!-- Random Question Button (Center) -->
<div class="remote-button-container center">
<button class="switch_button smooth-transition flex-center" id="switchQuestion" type="button" title="Random Question in Current Topic">
<img id="changeQ" src="../assets/images/icons/refresh.svg" alt="Switch Question" width="24" height="24">
</button>
<span class="remote-label">Random Question</span>
</div>
<!-- Next Question Button -->
<div class="remote-button-container">
<button class="remote-btn smooth-transition" id="nextQuestionBtn" type="button" title="Next Question">
<img src="../assets/images/icons/next.svg" alt="Next" width="20" height="20">
</button>
<span class="remote-label">Next</span>
</div>
</div>
</div>
<!-- Image-based preference selection -->
<div class="preference-container" id="preferenceContainer" class="hidden">
    <div class="preference-options" id="optionsContainer">
        <!-- Options will be rendered by JS -->
    </div>
</div>
<input type="hidden" id="selectedPreference" value="">

<!-- Answer Progress Display for Multiplayer -->
<div id="answerProgressContainer" class="answer-progress-container hidden">
    <p id="answerProgress">0/0 players answered</p>
    <button class="fin" id="revealAnswersBtn" type="button">Reveal All Answers</button>
    
</div>
<button class="fin" id="end_game_btn" type="button">End Game & Show All Results</button>
<!-- Discussion Timer Display (Host) -->
<div id="hostTimerContainer" class="answer-progress-container hidden">
    <p>Discussion time remaining: <strong id="hostTimer">0:00</strong></p>
</div>

<!-- Question Results Bar (Multiplayer - shows after revealing answers) -->
<div id="questionResultsBar" class="question-results-bar">
    <h4> Results:</h4>
    <div id="resultsBarContent"></div>
</div>

<!-- All Results Display (shows all questions at end of game) -->
<div id="allResultsDisplay" class="all-results-display hidden">
    <div class="results-overlay-bg"></div>
    <div class="results-modal">
        <h2>Game Results</h2>
        <div class="results-navigation">
            <button id="prevResultBtn" class="nav-btn">← Previous</button>
            <span id="resultCounter">Question 1 of X</span>
            <button id="nextResultBtn" class="nav-btn">Next →</button>
        </div>
        <div id="allResultsContent"></div>
        <button id="closeResultsBtn" class="close-results-btn">Close Results</button>
    </div>
</div>
</div><!-- End gameContainer -->

<!-- Results Section (hidden during gameplay) -->
<section id="gameResults" class="game-results hidden">
    <div class="results-container">
        <header class="results-header">
            <h2> Game Complete!</h2>
            <p class="results-subtitle">Here's a summary of your Table Talk session</p>
        </header>
        
        <div class="results-content">
            <div class="game-stats">
                <div class="stat-item">
                    <span class="stat-label">Questions Answered:</span>
                    <span class="stat-value" id="totalQuestions">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Players:</span>
                    <span class="stat-value" id="totalPlayers">0</span>
                </div>
            </div>
            
            <div class="questions-summary">
                <h3>Questions & Answers</h3>
                <div id="questionsList" class="questions-list">
                    <!-- Questions and answers will be populated here -->
                </div>
            </div>
        </div>
        
        <div class="results-actions">
            <button class="start-btn" id="continueGameBtn" type="button">Continue Playing</button>
            <button class="secondary-btn" id="playAgainBtn" type="button">Play Again</button>
            <button class="secondary-btn" id="backToMenuBtn" type="button">Back to Menu</button>
        </div>
    </div>
</section>
</main>

<footer>
<h2>About: </h2>
<p>The purpose of this game is to get to know people.</p>
<p>Ask Away</p>
</footer>

<!-- Conditionally load multiplayer scripts -->
<script src="../dev-tools/dev-tools.js" defer></script>

</body>
</html>