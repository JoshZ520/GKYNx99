<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Talk - Start!</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css">
    <link rel="stylesheet" href="../assets/css/core/shared.css">
    <link rel="stylesheet" href="../assets/css/core/index.css">
    <!-- Clean script architecture -->
    <script src="../src/utilities/theme-utilities.js" defer></script>
</head>
<body class="front-page" id="root">
    <div class="card">
        <header>
            <h1>Table Talk</h1>
            <p class="tagline">A fun conversation game where everyone plays on their phone</p>
            <p class="lead" id="front-instruction">Host creates the game, everyone joins with their phones using the room code!</p>
        </header>
        <main>
            <!-- Connection Status -->
            <div id="connectionSection" class="connection-section">
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot" id="statusDot">●</span>
                    <span id="statusText">Connecting to server...</span>
                </div>
            </div>

            <!-- Resume Game Section -->
            <div class="resume-section" id="resumeSection" class="hidden">
                <h3>Continue Previous Game</h3>
                <p class="resume-instruction">Pick up where you left off with a saved game:</p>
                <div class="saved-games-list" id="savedGamesList">
                    <!-- Saved games will be populated here -->
                </div>
                <div class="resume-actions">
                    <button type="button" class="secondary-btn" id="newGameBtn">Start Fresh Game Instead</button>
                </div>
            </div>

            <!-- New Game Section -->
            <div class="new-game-section" id="newGameSection">
                <!-- Step 1: Choose Game Mode -->
                <div class="step-section" id="createRoomStep">
                    <h3>Step 1: Choose Game Mode</h3>
                    <p class="step-instruction">Select how you want to play:</p>
                    
                    <div class="create-room-container">
                        <button class="start-btn" id="createRoomBtn" type="button">
                            <span>Create Multiplayer Game</span>
                        </button>
                        <p class="game-mode-description">Everyone joins with their phones using a room code</p>
                    </div>
                    
                    <div class="create-room-container" style="margin-top: 20px;">
                        <button class="secondary-btn" id="offlineDirectBtn" type="button" onclick="showOfflineSetup()">
                            <span>Start Offline Mode</span>
                        </button>
                        <p class="game-mode-description">Single device - everyone takes turns</p>
                    </div>
                </div>

                <!-- Step 2: Room Created - Show Code -->
                <div class="step-section hidden" id="roomCreatedStep">
                    <h3>Step 2: Share Room Code</h3>
                    <p class="step-instruction">Tell everyone to go to <strong>https://table-talk.onrender.com/player</strong> on their phones and enter this code:</p>
                    
                    <div class="room-code-display">
                        <div class="room-code-container">
                            <span class="room-code-label">Room Code:</span>
                            <div class="room-code" id="roomCodeDisplay">----</div>
                            <button class="copy-btn" id="copyRoomCodeBtn" title="Copy to clipboard">Copy</button>
                        </div>
                    </div>

                    <!-- Players Joining -->
                    <div class="players-joining">
                        <h4>Players Joining (<span id="joinedPlayersCount">0</span>):</h4>
                        <div class="players-list" id="joinedPlayersList">
                            <div class="no-players">Waiting for players to join...</div>
                        </div>
                    </div>

                    <!-- Start Game Button -->
                    <div class="start-game-container">
                        <button class="start-btn disabled" id="startGameBtn" type="button" disabled>
                            <span id="startGameText">Waiting for players...</span>
                        </button>
                        <p class="min-players-note">Need at least 2 players to start</p>
                    </div>
                </div>

                <!-- Offline Mode Fallback -->
                <div class="step-section hidden" id="offlineFallback">
                    <h3>Server Connection Issue</h3>
                    <p class="step-instruction">Can't connect to multiplayer server. Switch to offline mode:</p>
                    <div class="offline-container">
                        <button class="start-btn" id="offlineGameBtn" type="button" onclick="showOfflineSetup()">
                            <span>Switch to Offline Mode</span>
                        </button>
                        <p class="offline-note">Single-device gameplay with manual player turns</p>
                        <p class="offline-note"><small>Tip: Try refreshing this page first - server might be starting up</small></p>
                    </div>
                </div>
            </div>

            <!-- Offline Game Setup Section (Enhanced) -->
            <div class="new-game-section hidden" id="offlineSetupSection">
                <!-- Step 1: Player Count -->
                <div class="step-section" id="playerCountStep">
                    <h3>Step 1: Choose Players</h3>
                    <p class="step-instruction">Select how many players will be taking turns:</p>
                    <div class="create-room-container">
                        <div class="player-count-selector">
                            <label for="player_count">Number of Players:</label>
                            <input type="number" id="player_count" min="2" max="20" placeholder="Enter number (2-20)" required oninput="generatePlayerInputs(this.value)">
                        </div>
                    </div>
                </div>

                <!-- Step 2: Player Names -->
                <div class="step-section hidden" id="playerNamesStep">
                    <h3>Step 2: Enter Player Names</h3>
                    <p class="step-instruction">Add names for each player who will be participating:</p>
                    
                    <div class="players-joining">
                        <h4>Player Names:</h4>
                        <div id="playerNamesContainer" class="players-list">
                            <!-- Player name inputs will be generated here -->
                        </div>
                    </div>

                    <!-- Start Game Button -->
                    <div class="start-game-container">
                        <button class="start-btn disabled" id="startGame" type="button" disabled>
                            <span id="startGameText">Fill all player names to start</span>
                        </button>
                        <p class="min-players-note">All players need names to begin</p>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="step-section">
                    <div class="offline-container">
                        <button class="secondary-btn" id="backToMultiplayerBtn" type="button" onclick="showMultiplayerSetup()">
                            ← Back to Multiplayer
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Socket.io for multiplayer -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- Clean multiplayer manager -->
    <script src="../src/multiplayer/multiplayer-manager.js" defer></script>
    <!-- Offline mode functionality -->
    <script src="../src/multiplayer/front-offline.js" defer></script>
    <script src="../src/multiplayer/player-setup.js" defer></script>
    
    <!-- UI Switching Functions -->
    <script>
        function showOfflineSetup() {
            // Hide multiplayer sections
            document.getElementById('newGameSection').classList.add('hidden');
            document.getElementById('resumeSection').classList.add('hidden');
            document.getElementById('connectionSection').classList.add('hidden');
            document.getElementById('offlineFallback').classList.add('hidden');
            
            // Show offline setup
            document.getElementById('offlineSetupSection').classList.remove('hidden');
            
            // Update header content for offline mode
            const tagline = document.querySelector('.tagline');
            const instruction = document.getElementById('front-instruction');
            tagline.textContent = 'Offline Mode - Single Device Game';
            instruction.textContent = 'Everyone takes turns on this device - pass it around after each turn!';
        }
        
        function showMultiplayerSetup() {
            // Hide offline sections
            document.getElementById('offlineSetupSection').classList.add('hidden');
            document.getElementById('playerNamesStep').classList.add('hidden');
            
            // Show multiplayer sections
            document.getElementById('newGameSection').classList.remove('hidden');
            document.getElementById('resumeSection').classList.remove('hidden');
            document.getElementById('connectionSection').classList.remove('hidden');
            
            // Reset header content for multiplayer mode
            const tagline = document.querySelector('.tagline');
            const instruction = document.getElementById('front-instruction');
            tagline.textContent = 'A fun conversation game where everyone plays on their phone';
            instruction.textContent = 'Host creates the game, everyone joins with their phones using the room code!';
            
            // Reset to step 1
            document.getElementById('createRoomStep').classList.remove('hidden');
            document.getElementById('roomCreatedStep').classList.add('hidden');
        }
    </script>
    
    <!-- UI Mode Switching -->
    <script>
        function showOfflineSetup() {
            // Hide multiplayer sections
            document.getElementById('newGameSection')?.classList.add('hidden');
            document.getElementById('resumeSection')?.classList.add('hidden');
            document.getElementById('offlineFallback')?.classList.add('hidden');
            
            // Show offline setup section
            document.getElementById('offlineSetupSection')?.classList.remove('hidden');
            
            // Update header for offline mode
            updateHeaderForMode('offline');
        }
        
        function showMultiplayerSetup() {
            // Hide offline sections
            document.getElementById('offlineSetupSection')?.classList.add('hidden');
            
            // Show multiplayer sections
            document.getElementById('newGameSection')?.classList.remove('hidden');
            
            // Update header for multiplayer mode
            updateHeaderForMode('multiplayer');
        }
        
        function updateHeaderForMode(mode) {
            const tagline = document.querySelector('.tagline');
            const instruction = document.getElementById('front-instruction');
            
            if (mode === 'offline') {
                if (tagline) tagline.textContent = 'Offline Mode - Single Device Game';
                if (instruction) instruction.textContent = 'Everyone takes turns on this device - pass it around after each turn!';
            } else {
                if (tagline) tagline.textContent = 'A fun conversation game where everyone plays on their phone';
                if (instruction) instruction.textContent = 'Host creates the game, everyone joins with their phones using the room code!';
            }
        }
    </script>
</body>
</html>